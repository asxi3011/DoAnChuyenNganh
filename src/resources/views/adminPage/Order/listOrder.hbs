

<div class="container pd-admin ">
  <div class="pd-bd-admin box-shadow-1 text-white bg-child-admin">
    <h1>Danh sách đơn hàng</h1>
<div>
     
    {{!-- <div class="d-flex my-2 align-items-center justify-content-between">
      <a href="category/bin" class="a-none btn btn-dark-custom">
          <i class="fas fa-trash"></i> Thùng rác 
          {{#if numTrash}}
          ({{numTrash}})
          {{else}}
          (0) 
          {{/if}}
      </a>
      <div class="d-flex gap-3"> 
      <span class="d-flex align-items-center gap-2">
      <input class="form-check-input" type="checkbox" value="" id="chkCheckAll"> <span>SelectAll</span> 
      </span>
      <button type="button" class="btn btn-danger" id="btn_Remove_Many"  data-bs-toggle="modal" data-bs-target="#ModalDeleteMany"disabled>
          Xoá các mục được chọn
      </button>
      </div>
    </div> --}}
    
  <form method="POST" name="removeManyCategory" action="removeManyCategory?_method=DELETE">
  <div id='appendListCategory'>
  
    {{#if data}}
        <table class="table table-success table-striped my-3 align-middle text-center ">
           <tr>
              <th class="">STT</th>
              <th class="">Mã Đơn</th>
                <th class="">Trạng thái</th> 
              <th class="">Tên người Đặt</th>
              <th class="">Sđt</th>
         
     
              <th class="">Tổng đơn</th> 
              <th class="">Ngày đặt</th> 
              <th class="">Thao tác</th> 
            </tr>
      {{#each data}}

            <tr>
              <td class="">{{inc @index}}</td>
              <td class="">{{idOrder}}</td>
              <td class="statusOrder">{{statusOrder}}</td>
              <td class="">{{hotenOrder}}</td>

              <td class="">{{sdtOrder}}</td>
            
              <td class="">{{priceTotal}}</td>
              <td class="">{{dateConvert}}</td>
              <td class="">
                    <div class="btn btn-danger my-2 {{checkStatus statusOrder}}"  data-bs-toggle="modal" data-bs-target="#ModalDelete" data-id="{{this._id}}" title="Từ chối đơn hàng"><i class="fas fa-times"></i></div>
                     <button class="btn btn-blue-custom my-2 btn_details_order" type="button" value="{{this._id}}" title="Chi tiết đơn hàng" >
                     <i class="fas fa-eye"></i>
                    
                   
                     </button>
                    
                     <button class="btn btn-dark-custom my-2 btn_edit_category {{checkStatus statusOrder}}" type="button" value="{{this._id}}" title="Xác nhận đơn hàng" onclick="activeDonHang(this.value,'active')"><i class="fas fa-check"></i></button>

                   
              </td> 
            </tr>


      {{/each}}
      </table>
      {{else}}
           {{>empty}}
    {{/if}}
  </div>
 
</div>

<form name="removeItemCategory" method="POST" ></form>
</div>
</div>

<div class="modal fade" id="ModalDelete" tabindex="-1" aria-labelledby="TitleModalDelete" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TitleModalDelete">Thông báo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Bạn muốn từ chối đơn hàng này ?
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Huỷ bỏ</button>
        <button type="button" class="btn btn-danger del-category" >Đồng ý </button>
      </div>
    </div>
  </div>
</div>

<form name="frmGetDetails" method="GET"></form>
<script>
  document.addEventListener('DOMContentLoaded',function(){
      
      
      // Khai báo biến
      //Button
      var btnThemLine = $('#btn_ThemLine_Category')
       var btn_Remove_Many = $('#btn_Remove_Many')
      var btnSubmit =$('#btn_submit_Category');
      //element
      var element_line_category = $('#appendLineAddCategory');
       //checkbox
       var CategoryItemcheckbox = $('input[name="select_Category[]"]');
       var chkCheckAll = $('#chkCheckAll');
      var checkboxName = 'select_Category[]';
      //Modal
      var ModalDelete = document.getElementById('ModalDelete');
      var ModalDeleteMany = document.getElementById('ModalDeleteMany');
      //forms
      var formRemoveItemCategory = document.forms['removeItemCategory'];
      var removeManyCategory = document.forms['removeManyCategory'];
      var storeCategory = document.forms['storeCategory'];
      var btn_edit_category = $('.btn_edit_category');
      var frmCategoryEdit = document.forms['frmCategoryEdit'];
      var frmGetDetails = document.forms['frmGetDetails'];
      //Bien cuc bo
      var countElemet = 0;
      var name ='nameCategory';
      var icon ='iconCategory';
      var btn_details_order = $('.btn_details_order');
        var collectionStatusOrder = document.querySelectorAll('.statusOrder');
        collectionStatusOrder.forEach(element=>{
            if(element.innerHTML ==='pending'){
                element.style.color = 'yellow';
            }
            else if(element.innerHTML ==='active'){
                 element.style.color = 'green';
            }
            else{
                 element.style.color = 'red';
            }
        })
    
       
          //Show Modal Delete
          ModalDelete.addEventListener('show.bs.modal', function (event) {
            // Button that triggered the modal  
             
             var button = event.relatedTarget;
              var idDonHang = button.getAttribute('data-id')
            // Extract info from data-bs-* attributes
              var delCategory=document.querySelector('.del-category');
         
              delCategory.onclick =function(){
                  activeDonHang(idDonHang,'cancel');
              }
            })
         
         btn_details_order.on('click',function(e){
           var id = e.currentTarget.value;
            frmGetDetails.action = `/me/detailsOrder/${id}`;
            frmGetDetails.submit();
         })
       
         
            
            
    
})
  function activeDonHang(id,status){
           
               axios.post('/me/activeDonHang', {
                   id:id,
                   status:status,
                })
                .then(function (response) {
                   if(response.data == 'success'){
                       location.reload();
                   }
                   else{
                       alert('vui lòng thử lại');
                   }
                })
                .catch(function (error) {
                    console.log(error);
                });
                
             
           }

     
</script>

